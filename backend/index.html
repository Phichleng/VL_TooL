<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Hand Video - Fixed</title>
    
    <!-- React and dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Socket.IO for real-time updates -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <style>
        .progress-active {
            background-image: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 40px 40px;
            animation: progressStripes 1s linear infinite;
        }
        
        @keyframes progressStripes {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }
        
        .download-item {
            transition: all 0.3s ease;
        }
        
        .download-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .streaming-pulse {
            animation: pulse 2s infinite;
        }
        
        .download-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .download-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .download-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        
        .error-alert {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const EnhancedVideoDownloader = () => {
            // State management
            const [socket, setSocket] = useState(null);
            const [connectionStatus, setConnectionStatus] = useState('disconnected');
            const [activeTab, setActiveTab] = useState('single');
            const [downloads, setDownloads] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [error, setError] = useState(null);
            
            // Form states
            const [singleUrl, setSingleUrl] = useState('');
            const [batchUrls, setBatchUrls] = useState('');
            const [infoUrl, setInfoUrl] = useState('');
            const [videoInfo, setVideoInfo] = useState(null);

            const API_BASE = `${window.location.protocol}//${window.location.host}/api`;

            // WebSocket connection
            useEffect(() => {
                const newSocket = io(window.location.origin, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionAttempts: 5,
                    reconnectionDelay: 1000
                });

                newSocket.on('connect', () => {
                    console.log('Connected to streaming server');
                    setConnectionStatus('connected');
                    setSocket(newSocket);
                    newSocket.emit('get_downloads');
                });

                newSocket.on('disconnect', () => {
                    console.log('Disconnected from server');
                    setConnectionStatus('disconnected');
                });

                newSocket.on('download_progress', (data) => {
                    updateDownloadProgress(data.id, data);
                });

                newSocket.on('download_status', (data) => {
                    updateDownloadStatus(data.id, data);
                });

                newSocket.on('downloads_update', (data) => {
                    if (data.downloads) {
                        setDownloads(data.downloads);
                    }
                });

                return () => newSocket.close();
            }, []);

            const updateDownloadProgress = (id, progressData) => {
                setDownloads(prev => prev.map(download => 
                    download.id === id ? { ...download, ...progressData, last_update: Date.now() } : download
                ));
            };

            const updateDownloadStatus = (id, statusData) => {
                setDownloads(prev => prev.map(download => 
                    download.id === id ? { ...download, ...statusData, last_update: Date.now() } : download
                ));
            };

            const showError = (errorData) => {
                setError(errorData);
                setTimeout(() => setError(null), 10000); // Clear error after 10 seconds
            };

            // Enhanced error handling function
            const handleApiError = (response, defaultMessage) => {
                if (response.error) {
                    showError({
                        title: response.error,
                        message: response.details || defaultMessage,
                        suggestion: response.suggestion,
                        type: 'error'
                    });
                    return true;
                }
                return false;
            };

            // Direct streaming download function with better error handling
            const handleDirectDownload = async (url) => {
                if (!url.trim()) return;
                
                setIsProcessing(true);
                setError(null);
                
                try {
                    const response = await fetch(`${API_BASE}/download/quick`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url })
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        const newDownload = {
                            id: result.download_id,
                            url: url,
                            title: result.title,
                            filename: result.filename,
                            filesize: result.filesize,
                            platform: result.platform,
                            status: 'ready',
                            progress: 0,
                            downloaded_bytes: 0,
                            total_bytes: result.filesize || 0,
                            created_at: new Date().toISOString(),
                            type: 'streaming'
                        };
                        
                        setDownloads(prev => [newDownload, ...prev]);
                        
                        // Start streaming download immediately
                        setTimeout(() => startStreamingDownload(result.download_id, result.stream_url, result.filename), 500);
                        
                        return true;
                    } else {
                        handleApiError(result, 'Failed to process video URL');
                        return false;
                    }
                } catch (error) {
                    showError({
                        title: 'Connection Error',
                        message: `Unable to connect to server: ${error.message}`,
                        suggestion: 'Please check your internet connection and try again.',
                        type: 'error'
                    });
                    return false;
                } finally {
                    setIsProcessing(false);
                }
            };

            const startStreamingDownload = async (downloadId, streamUrl, filename) => {
                try {
                    updateDownloadStatus(downloadId, { status: 'streaming' });

                    const response = await fetch(streamUrl);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const reader = response.body.getReader();
                    const contentLength = +response.headers.get('Content-Length');
                    
                    let receivedLength = 0;
                    const chunks = [];
                    let lastProgressTime = Date.now();
                    const startTime = Date.now();
                    
                    while (true) {
                        const { done, value } = await reader.read();
                        
                        if (done) break;
                        
                        chunks.push(value);
                        receivedLength += value.length;
                        
                        const currentTime = Date.now();
                        if (currentTime - lastProgressTime >= 200) {
                            const elapsedSeconds = (currentTime - startTime) / 1000;
                            const speed = receivedLength / elapsedSeconds;
                            const percentage = contentLength ? (receivedLength / contentLength) * 100 : 0;
                            const eta = contentLength && speed > 0 ? (contentLength - receivedLength) / speed : 0;
                            
                            updateDownloadProgress(downloadId, {
                                downloaded_bytes: receivedLength,
                                total_bytes: contentLength || 0,
                                percentage: Math.round(percentage * 10) / 10,
                                speed: speed,
                                eta: eta,
                                status: 'streaming'
                            });
                            
                            lastProgressTime = currentTime;
                        }
                    }

                    // Create blob and trigger download
                    const blob = new Blob(chunks);
                    const downloadUrl = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = filename;
                    link.style.display = 'none';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => URL.revokeObjectURL(downloadUrl), 1000);
                    
                    const totalTime = (Date.now() - startTime) / 1000;
                    updateDownloadStatus(downloadId, { 
                        status: 'completed', 
                        percentage: 100,
                        progress: 100,
                        total_time: totalTime
                    });

                    // Show success notification
                    showError({
                        title: 'Download Complete',
                        message: `${filename} has been downloaded successfully!`,
                        type: 'success'
                    });

                } catch (error) {
                    console.error('Streaming download error:', error);
                    updateDownloadStatus(downloadId, { 
                        status: 'error', 
                        error: error.message 
                    });
                    
                    showError({
                        title: 'Download Failed',
                        message: `Failed to download video: ${error.message}`,
                        suggestion: 'Please try again or check if the video is still available.',
                        type: 'error'
                    });
                }
            };

            const handleSingleDownload = async () => {
                if (await handleDirectDownload(singleUrl)) {
                    setSingleUrl('');
                }
            };

            const handleBatchDownload = async () => {
                if (!batchUrls.trim()) return;
                
                const urls = batchUrls.split('\n').filter(url => url.trim());
                if (urls.length === 0) return;
                
                setIsProcessing(true);
                let successCount = 0;
                let failureCount = 0;
                
                for (let i = 0; i < urls.length; i++) {
                    const success = await handleDirectDownload(urls[i]);
                    if (success) {
                        successCount++;
                    } else {
                        failureCount++;
                    }
                    
                    if (i < urls.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }
                
                showError({
                    title: 'Batch Download Complete',
                    message: `${successCount} downloads started successfully. ${failureCount} failed.`,
                    type: successCount > 0 ? 'success' : 'error'
                });
                
                setBatchUrls('');
                setIsProcessing(false);
            };

            const handleGetVideoInfo = async () => {
                if (!infoUrl.trim()) return;
                
                setIsProcessing(true);
                setVideoInfo(null);
                setError(null);
                
                try {
                    const response = await fetch(`${API_BASE}/video-info`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: infoUrl })
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        setVideoInfo(result);
                        showError({
                            title: 'Video Information Retrieved',
                            message: 'Video details loaded successfully!',
                            type: 'success'
                        });
                    } else {
                        handleApiError(result, 'Failed to get video information');
                        setVideoInfo(null);
                    }
                } catch (error) {
                    showError({
                        title: 'Connection Error',
                        message: `Unable to get video information: ${error.message}`,
                        type: 'error'
                    });
                }
                
                setIsProcessing(false);
            };

            const clearDownloads = () => {
                setDownloads(prev => prev.filter(d => 
                    ['ready', 'streaming'].includes(d.status)
                ));
                showError({
                    title: 'Downloads Cleared',
                    message: 'Completed and failed downloads have been cleared.',
                    type: 'info'
                });
            };

            // Utility functions
            const formatBytes = (bytes) => {
                if (!bytes || bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            };

            const formatSpeed = (speed) => {
                return speed ? formatBytes(speed) + '/s' : '';
            };

            const formatTime = (seconds) => {
                if (!seconds || seconds < 0) return '';
                if (seconds < 60) return `${Math.round(seconds)}s`;
                
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}m ${secs.toString().padStart(2, '0')}s`;
            };

            const getStatusIcon = (status) => {
                const icons = {
                    'ready': '‚è≥',
                    'streaming': 'üì°',
                    'completed': '‚úÖ',
                    'error': '‚ùå'
                };
                return icons[status] || '‚ùì';
            };

            const getStatusColor = (status) => {
                const colors = {
                    'ready': 'bg-yellow-100 text-yellow-800',
                    'streaming': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'error': 'bg-red-100 text-red-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            const getPlatformColor = (platform) => {
                const colors = {
                    tiktok: 'bg-pink-100 text-pink-800',
                    youtube: 'bg-red-100 text-red-800',
                    instagram: 'bg-purple-100 text-purple-800',
                    facebook: 'bg-blue-100 text-blue-800',
                    unknown: 'bg-gray-100 text-gray-800'
                };
                return colors[platform] || colors.unknown;
            };

            // Error Alert Component
            const ErrorAlert = ({ error, onClose }) => {
                if (!error) return null;

                const bgColor = error.type === 'success' ? 'bg-green-50 border-green-200' :
                               error.type === 'info' ? 'bg-blue-50 border-blue-200' :
                               'bg-red-50 border-red-200';
                
                const textColor = error.type === 'success' ? 'text-green-800' :
                                 error.type === 'info' ? 'text-blue-800' :
                                 'text-red-800';

                const iconColor = error.type === 'success' ? 'text-green-500' :
                                 error.type === 'info' ? 'text-blue-500' :
                                 'text-red-500';

                return (
                    <div className={`error-alert fixed top-4 right-4 max-w-md p-4 border rounded-lg shadow-lg z-50 ${bgColor}`}>
                        <div className="flex items-start">
                            <div className={`flex-shrink-0 ${iconColor} text-xl mr-3`}>
                                {error.type === 'success' ? '‚úÖ' : 
                                 error.type === 'info' ? '‚ÑπÔ∏è' : '‚ùå'}
                            </div>
                            <div className="flex-1">
                                <h4 className={`font-semibold ${textColor} mb-1`}>{error.title}</h4>
                                <p className={`text-sm ${textColor} mb-2`}>{error.message}</p>
                                {error.suggestion && (
                                    <p className={`text-xs ${textColor} opacity-80`}>
                                        üí° {error.suggestion}
                                    </p>
                                )}
                            </div>
                            <button
                                onClick={onClose}
                                className={`flex-shrink-0 ml-2 ${textColor} hover:opacity-70`}
                            >
                                ‚úñ
                            </button>
                        </div>
                    </div>
                );
            };

            // Enhanced Download Item Component
            const DownloadItem = ({ download }) => {
                const [expanded, setExpanded] = useState(false);
                const isActive = download.status === 'streaming';
                
                return (
                    <div className={`download-item border border-gray-200 rounded-lg p-3 ${download.status === 'error' ? 'bg-red-50' : ''}`}>
                        <div className="flex items-start justify-between mb-2">
                            <div className="flex-1 min-w-0">
                                <div className="flex items-center space-x-2 mb-1">
                                    <span className="text-lg" title={download.status}>
                                        {getStatusIcon(download.status)}
                                    </span>
                                    <span className={`px-2 py-1 rounded text-xs font-medium ${getPlatformColor(download.platform)}`}>
                                        {download.platform.toUpperCase()}
                                    </span>
                                    <span className={`px-2 py-1 rounded text-xs font-medium ${getStatusColor(download.status)}`}>
                                        {download.status.toUpperCase()}
                                    </span>
                                    {download.status === 'streaming' && (
                                        <span className="px-2 py-1 rounded text-xs font-medium bg-gradient-to-r from-blue-500 to-purple-600 text-white streaming-pulse">
                                            STREAMING
                                        </span>
                                    )}
                                </div>
                                
                                <h4 className="text-sm font-medium text-gray-900 mb-1 line-clamp-2">
                                    {download.title || 'Loading...'}
                                </h4>
                                
                                <p className="text-xs text-gray-500 truncate" title={download.url}>
                                    {download.url}
                                </p>
                            </div>
                            
                            <button 
                                onClick={() => setExpanded(!expanded)}
                                className="text-gray-400 hover:text-blue-500 transition-colors text-sm ml-2"
                            >
                                {expanded ? '‚ñ≤' : '‚ñº'}
                            </button>
                        </div>

                        {/* Progress Bar for Active Downloads */}
                        {isActive && (
                            <div className="mb-2">
                                <div className="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                    <div 
                                        className={`bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300 ${isActive ? 'progress-active' : ''}`}
                                        style={{ width: `${download.percentage || 0}%` }}
                                    ></div>
                                </div>
                                <div className="flex justify-between text-xs text-gray-600 mt-1">
                                    <span className="font-medium">{Math.round(download.percentage || 0)}%</span>
                                    <div className="flex space-x-2">
                                        {download.downloaded_bytes > 0 && (
                                            <span>{formatBytes(download.downloaded_bytes)}</span>
                                        )}
                                        {download.total_bytes > 0 && download.downloaded_bytes > 0 && (
                                            <span>/ {formatBytes(download.total_bytes)}</span>
                                        )}
                                        {download.speed > 0 && (
                                            <span>{formatSpeed(download.speed)}</span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Expanded Details */}
                        {expanded && (
                            <div className="mt-2 pt-2 border-t border-gray-200 text-xs space-y-1">
                                <div className="grid grid-cols-2 gap-2">
                                    <div><span className="font-medium">Status:</span></div>
                                    <div>
                                        <span className={`px-2 py-1 rounded ${getStatusColor(download.status)}`}>
                                            {download.status}
                                        </span>
                                    </div>
                                    
                                    {download.filesize && (
                                        <>
                                            <div><span className="font-medium">Size:</span></div>
                                            <div>{formatBytes(download.filesize)}</div>
                                        </>
                                    )}
                                    
                                    <div><span className="font-medium">Started:</span></div>
                                    <div>{new Date(download.created_at).toLocaleTimeString()}</div>
                                    
                                    {download.total_time && (
                                        <>
                                            <div><span className="font-medium">Duration:</span></div>
                                            <div>{formatTime(download.total_time)}</div>
                                        </>
                                    )}
                                </div>
                                
                                {download.error && (
                                    <div className="mt-2 p-2 bg-red-50 rounded border border-red-200">
                                        <span className="font-medium text-red-800">Error:</span>
                                        <p className="text-red-700 break-words">{download.error}</p>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="flex items-center justify-between mt-2">
                            <span className="text-xs text-gray-500 font-medium">
                                {download.status === 'streaming' ? 'Downloading directly...' : 
                                 download.status === 'completed' ? 'Download completed!' :
                                 download.status === 'error' ? 'Download failed' :
                                 'Ready to download'}
                            </span>
                            
                            {download.status === 'completed' && (
                                <span className="text-xs text-green-600 font-medium">
                                    Saved to Downloads
                                </span>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
                    {/* Error Alert */}
                    <ErrorAlert error={error} onClose={() => setError(null)} />
                    
                    <div className="container mx-auto px-4 py-8">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                                Fast Hand Video
                            </h1>
                            <p className="text-gray-600 text-lg mb-2">
                                Enhanced Video Downloader - Fixed Version
                            </p>
                            <div className="flex justify-center items-center space-x-3">
                                <div className={`w-2 h-2 rounded-full ${connectionStatus === 'connected' ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                <span className={`text-sm font-medium ${connectionStatus === 'connected' ? 'text-green-600' : 'text-red-600'}`}>
                                    {connectionStatus === 'connected' ? 'Connected' : 'Disconnected'}
                                </span>
                            </div>
                        </div>

                        <div className="grid lg:grid-cols-3 gap-8">
                            {/* Main Panel */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-xl shadow-lg border border-gray-100">
                                    {/* Tab Navigation */}
                                    <div className="border-b border-gray-200">
                                        <div className="flex">
                                            {[
                                                { id: 'single', label: 'Single Video' },
                                                { id: 'batch', label: 'Batch Download' },
                                                { id: 'info', label: 'Video Info' }
                                            ].map(({ id, label }) => (
                                                <button
                                                    key={id}
                                                    onClick={() => setActiveTab(id)}
                                                    className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${
                                                        activeTab === id
                                                            ? 'border-blue-500 text-blue-600'
                                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                                    }`}
                                                >
                                                    {label}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Tab Content */}
                                    <div className="p-6">
                                        {activeTab === 'single' && (
                                            <div className="space-y-4">
                                                <h3 className="text-lg font-semibold mb-4">Single Video Download</h3>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Video URL
                                                    </label>
                                                    <input
                                                        type="url"
                                                        value={singleUrl}
                                                        onChange={(e) => setSingleUrl(e.target.value)}
                                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="https://www.tiktok.com/@user/video/... or any supported platform"
                                                    />
                                                </div>
                                                <button
                                                    onClick={handleSingleDownload}
                                                    disabled={!singleUrl.trim() || isProcessing || connectionStatus !== 'connected'}
                                                    className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-blue-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
                                                >
                                                    {isProcessing ? 'Processing...' : 'Download Now'}
                                                </button>
                                            </div>
                                        )}

                                        {activeTab === 'batch' && (
                                            <div className="space-y-4">
                                                <h3 className="text-lg font-semibold mb-4">Batch Download</h3>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Video URLs (One per line)
                                                    </label>
                                                    <textarea
                                                        value={batchUrls}
                                                        onChange={(e) => setBatchUrls(e.target.value)}
                                                        rows={6}
                                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="https://www.tiktok.com/@user/video/1&#10;https://www.youtube.com/watch?v=...&#10;https://www.instagram.com/p/..."
                                                    />
                                                </div>
                                                <button
                                                    onClick={handleBatchDownload}
                                                    disabled={!batchUrls.trim() || isProcessing || connectionStatus !== 'connected'}
                                                    className="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 px-4 rounded-lg hover:from-green-600 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
                                                >
                                                    {isProcessing ? 'Processing Batch...' : 'Download All Videos'}
                                                </button>
                                            </div>
                                        )}

                                        {activeTab === 'info' && (
                                            <div className="space-y-4">
                                                <h3 className="text-lg font-semibold mb-4">Get Video Information</h3>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Video URL
                                                    </label>
                                                    <input
                                                        type="url"
                                                        value={infoUrl}
                                                        onChange={(e) => setInfoUrl(e.target.value)}
                                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                        placeholder="https://www.youtube.com/watch?v=..."
                                                    />
                                                </div>
                                                <button
                                                    onClick={handleGetVideoInfo}
                                                    disabled={!infoUrl.trim() || isProcessing || connectionStatus !== 'connected'}
                                                    className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-indigo-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium"
                                                >
                                                    {isProcessing ? 'Getting Info...' : 'Get Video Info'}
                                                </button>

                                                {videoInfo && (
                                                    <div className="mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200">
                                                        <h4 className="font-semibold mb-3 text-blue-900">Video Information</h4>
                                                        <div className="grid grid-cols-1 gap-2 text-sm">
                                                            <div>
                                                                <span className="font-medium text-gray-700">Title:</span>
                                                                <p className="text-gray-600 break-words mt-1">{videoInfo.title}</p>
                                                            </div>
                                                            <div className="grid grid-cols-2 gap-4">
                                                                <div>
                                                                    <span className="font-medium text-gray-700">Platform:</span>
                                                                    <span className={`ml-2 px-2 py-1 rounded text-xs ${getPlatformColor(videoInfo.platform)}`}>
                                                                        {videoInfo.platform.toUpperCase()}
                                                                    </span>
                                                                </div>
                                                                {videoInfo.filesize && (
                                                                    <div>
                                                                        <span className="font-medium text-gray-700">Size:</span>
                                                                        <span className="ml-2 text-gray-600">{formatBytes(videoInfo.filesize)}</span>
                                                                    </div>
                                                                )}
                                                                {videoInfo.duration && (
                                                                    <div>
                                                                        <span className="font-medium text-gray-700">Duration:</span>
                                                                        <span className="ml-2 text-gray-600">{formatTime(videoInfo.duration)}</span>
                                                                    </div>
                                                                )}
                                                                {videoInfo.uploader && (
                                                                    <div>
                                                                        <span className="font-medium text-gray-700">Uploader:</span>
                                                                        <span className="ml-2 text-gray-600">{videoInfo.uploader}</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Important Notice */}
                                <div className="mt-6 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 border border-yellow-200">
                                    <h3 className="text-lg font-semibold text-yellow-800 mb-4">Important Notice</h3>
                                    <div className="text-sm text-yellow-700 space-y-2">
                                        <p>
                                            <strong>YouTube Authentication:</strong> Some YouTube videos may fail due to enhanced bot protection. 
                                            This is a known limitation when YouTube requires sign-in verification.
                                        </p>
                                        <p>
                                            <strong>Best Results:</strong> TikTok, Instagram, and Facebook videos typically work better 
                                            as they use multiple extraction methods and fallback services.
                                        </p>
                                        <p>
                                            <strong>If Download Fails:</strong> Try a different video or platform. Some videos may be 
                                            private, region-locked, or age-restricted.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* Downloads Sidebar */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-xl shadow-lg border border-gray-100 sticky top-4">
                                    <div className="p-4 border-b border-gray-200 flex items-center justify-between">
                                        <h3 className="text-lg font-semibold">
                                            Downloads ({downloads.length})
                                            {downloads.filter(d => d.status === 'streaming').length > 0 && (
                                                <span className="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                    {downloads.filter(d => d.status === 'streaming').length} active
                                                </span>
                                            )}
                                        </h3>
                                        {downloads.length > 0 && (
                                            <button
                                                onClick={clearDownloads}
                                                className="text-gray-400 hover:text-red-500 transition-colors text-sm"
                                                title="Clear completed downloads"
                                            >
                                                Clear
                                            </button>
                                        )}
                                    </div>
                                    
                                    <div className="p-4 max-h-96 overflow-y-auto download-scroll">
                                        {downloads.length === 0 ? (
                                            <div className="text-center py-8">
                                                <div className="text-6xl mb-4">üì±</div>
                                                <p className="text-gray-500 text-sm">No downloads yet</p>
                                                <p className="text-gray-400 text-xs mt-2">
                                                    Paste a video URL above to start downloading
                                                </p>
                                            </div>
                                        ) : (
                                            <div className="space-y-3">
                                                {downloads
                                                    .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                                                    .map((download) => (
                                                    <DownloadItem key={download.id} download={download} />
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Supported Platforms */}
                        <div className="mt-8 bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                            <h3 className="text-lg font-semibold mb-4">Supported Platforms</h3>
                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                <div className="text-center p-4 bg-pink-50 rounded-lg border border-pink-200">
                                    <div className="text-2xl mb-2">üéµ</div>
                                    <h4 className="font-medium text-pink-800 text-sm">TikTok</h4>
                                    <p className="text-xs text-pink-600 mt-1">Best Support</p>
                                </div>
                                <div className="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                    <div className="text-2xl mb-2">üé•</div>
                                    <h4 className="font-medium text-red-800 text-sm">YouTube</h4>
                                    <p className="text-xs text-red-600 mt-1">Limited Support</p>
                                </div>
                                <div className="text-center p-4 bg-purple-50 rounded-lg border border-purple-200">
                                    <div className="text-2xl mb-2">üì∏</div>
                                    <h4 className="font-medium text-purple-800 text-sm">Instagram</h4>
                                    <p className="text-xs text-purple-600 mt-1">Good Support</p>
                                </div>
                                <div className="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                    <div className="text-2xl mb-2">üë•</div>
                                    <h4 className="font-medium text-blue-800 text-sm">Facebook</h4>
                                    <p className="text-xs text-blue-600 mt-1">Good Support</p>
                                </div>
                                <div className="text-center p-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <div className="text-2xl mb-2">üåê</div>
                                    <h4 className="font-medium text-gray-800 text-sm">Others</h4>
                                    <p className="text-xs text-gray-600 mt-1">Via yt-dlp</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EnhancedVideoDownloader />);
    </script>
</body>
</html>